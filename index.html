<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Évaluation et Entretien Annuel</title>
    <style>
        /* Styles existants */
        body { 
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .container { 
            max-width: 800px;
            margin: auto;
        }
        table { 
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td { 
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
        }
        th { 
            background-color: #f4f4f4;
        }
        td:first-child { 
            text-align: left;
        }
        input, textarea { 
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            box-sizing: border-box;
        }
        textarea { 
            resize: none;
            overflow: hidden;
            min-height: 50px;
        }
        button { 
            background-color: #28a745;
            color: white;
            padding: 10px;
            border: none;
            cursor: pointer;
        }
        button:hover { 
            background-color: #218838;
        }
        .inline { 
            display: flex;
            gap: 40px;
            margin-bottom: 15px;
        }
        .inline label { 
            flex: 1;
        }
        .bold { 
            font-weight: bold;
            display: block;
            margin-top: 10px;
        }
        footer { 
            margin-top: 20px;
        }
        .sub-section { 
            margin-top: 15px;
            margin-left: 20px;
        }
        .decisions-section { 
            margin-top: 15px;
        }
        .decision-item { 
            margin-bottom: 15px;
            border: 1px solid #ddd;
            padding: 10px;
        }
        .radio-cell { 
            text-align: center;
        }
        footer .bold { 
            font-weight: bold;
        }
        .footer-inline { 
            display: flex;
            gap: 20px;
            align-items: center;
        }
        .footer-inline label { 
            white-space: nowrap;
        }
        input[type="date"] {
            width: 100px;
        }
        .radio-cell input[type="radio"] {
            margin: 0;
        }
        /* Boutons fixes pour la gestion des décisions */
        #decision-buttons {
            position: fixed;
            bottom: 80px;
            right: 20px;
            z-index: 1000;
        }
        #decision-buttons button {
            margin-right: 10px;
        }
        /* Bouton d'impression déjà en position fixe */
        #print-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
    </style>
    <script>
        // Fonction d'impression de la page
        function imprimerPage() {
            window.print();
        }

        // Fonction pour ajuster la hauteur des zones de texte (textarea)
        function autoResizeTextarea(el) {
            el.style.height = 'auto';
            el.style.height = (el.scrollHeight) + 'px';
        }

        // Mise à jour de la numérotation des décisions
        function updateDecisionNumbers() {
            const decisions = document.querySelectorAll('#decisions .decision-item');
            decisions.forEach((item, index) => {
                const label = item.querySelector('label');
                if(label) {
                    label.textContent = "Décision " + (index + 1) + " :";
                }
                // Met à jour les attributs name pour assurer une numérotation cohérente
                const textarea = item.querySelector('textarea');
                if(textarea) {
                    textarea.setAttribute("name", "decision_" + (index + 1));
                }
                const inputDate = item.querySelector('input[type="date"]');
                if(inputDate) {
                    inputDate.setAttribute("name", "delai_realisation_" + (index + 1));
                }
            });
        }

        // Fonction pour ajouter une décision
        function addDecision() {
            const container = document.getElementById('decisions');
            const currentCount = container.querySelectorAll('.decision-item').length;
            const decisionNumber = currentCount + 1;
            const decisionDiv = document.createElement('div');
            decisionDiv.className = 'decision-item';
            decisionDiv.innerHTML = `
                <label>Décision ${decisionNumber} :</label>
                <textarea name="decision_${decisionNumber}" oninput="autoResizeTextarea(this)"></textarea>
                <div class="inline-decision">
                    <label>Délai pour la réaliser :</label>
                    <input type="date" name="delai_realisation_${decisionNumber}">
                </div>
            `;
            container.appendChild(decisionDiv);
            updateDecisionNumbers();
        }

        // Fonction pour supprimer la dernière décision (sauf la première)
        function removeDecision() {
            const container = document.getElementById('decisions');
            const decisions = container.querySelectorAll('.decision-item');
            if(decisions.length > 1) {
                container.removeChild(decisions[decisions.length - 1]);
                updateDecisionNumbers();
            } else {
                alert("La première décision ne peut pas être supprimée.");
            }
        }

        // Ajout du redimensionnement automatique sur les textarea au chargement du DOM
        document.addEventListener("DOMContentLoaded", function() {
            document.querySelectorAll("textarea").forEach(textarea => {
                textarea.addEventListener("input", function() {
                    autoResizeTextarea(this);
                });
            });
        });
    </script>
</head>
<body>
    <div class="container">
        <!-- SECTION: Titre et Informations Personnelles -->
        <h2>Évaluation et Entretien Annuel</h2>
        <div id="informations-personnelles" class="inline">
            <label>Nom : <input type="text" name="nom"></label>
            <label>Prénom : <input type="text" name="prenom"></label>
        </div>
        <div id="dates-personnelles" class="inline">
            <label>Date de naissance : <input type="date" name="date_naissance"></label>
            <label>Entrée en fonction le : <input type="date" name="entree_fonction"></label>
        </div>
        
        <!-- SECTION: Critères d'Évaluation -->
        <table id="criteres-evaluation">
            <tr>
                <th>Critères</th>
                <th>--</th>
                <th>-</th>
                <th>N</th>
                <th>+</th>
                <th>++</th>
                <th>Remarques</th>
            </tr>
            <script>
                let criteres = [
                    "Performance au travail",
                    "Compétences dans les tâches",
                    "Satisfaction au poste de travail",
                    "Satisfaction dans l’entreprise",
                    "Soin du matériel et des véhicules",
                    "Comportement envers ses collègues",
                    "Comportement envers son supérieur",
                    "Comportement envers les clients",
                    "Assiduité - Respect horaires - Feuilles d’heures",
                    "Tenue vestimentaire & hygiène personnelle",
                    "Prise de responsabilités"
                ];
                
                criteres.forEach((critere, index) => {
                    document.write(`<tr>
                        <td>${critere}</td>
                        <td class="radio-cell"><input type="radio" name="critere${index}" value="--"></td>
                        <td class="radio-cell"><input type="radio" name="critere${index}" value="-"></td>
                        <td class="radio-cell"><input type="radio" name="critere${index}" value="N"></td>
                        <td class="radio-cell"><input type="radio" name="critere${index}" value="+"></td>
                        <td class="radio-cell"><input type="radio" name="critere${index}" value="++"></td>
                        <td><textarea oninput="autoResizeTextarea(this)"></textarea></td>
                    </tr>`);
                });
            </script>
        </table>

        <!-- SECTION: Améliorations Personnelles et Professionnelles -->
        <div id="ameliorations" class="section">
            <label class="bold">Que peux-tu améliorer ?</label><br>
            <label>Personnellement : <textarea name="amelioration_personnelle" oninput="autoResizeTextarea(this)"></textarea></label>
            <label>Dans le travail : <textarea name="amelioration_travail" oninput="autoResizeTextarea(this)"></textarea></label>
        </div>

        <!-- SECTION: Améliorations de l'Entreprise -->
        <div id="amelioration-entreprise" class="section">
            <label class="bold">Que pouvons-nous améliorer ?</label>
            <textarea name="amelioration_entreprise" oninput="autoResizeTextarea(this)"></textarea>
        </div>

        <!-- SECTION: Décisions -->
        <div id="decisions" class="section decisions-section">
            <label class="bold">Décisions prises en commun :</label><br>
            <!-- Base : une seule décision -->
            <div class="decision-item">
                <label>Décision 1 :</label>
                <textarea name="decision_1" oninput="autoResizeTextarea(this)"></textarea>
                <div class="inline-decision">
                    <label>Délai pour la réaliser :</label>
                    <input type="date" name="delai_realisation_1">
                </div>
            </div>
        </div>

        <!-- Boutons fixes pour ajouter/supprimer des décisions -->
        <div id="decision-buttons">
            <button onclick="addDecision()">Ajouter une décision</button>
            <button onclick="removeDecision()">Supprimer une décision</button>
        </div>

        <!-- SECTION: Informations de l'Entretien (Footer) -->
        <footer id="footer-entretien">
            <div class="footer-inline">
                <label class="bold">Entretien effectué le :</label>
                <input type="date" name="date_entretien">
                <label>Par :</label>
                <input type="text" name="responsable">
                <label>Collaborateur :</label>
                <input type="text" name="collaborateur">
            </div>
        </footer>
        
        <!-- Bouton d'impression fixé -->
        <button id="print-button" onclick="imprimerPage()">Imprimer</button>
    </div>
</body>
</html>
